if exists('g:loaded_pwn_ftplugin')
    finish
endif
let g:loaded_pwn_ftplugin = 1

" function! s:ExecuteInShell(command)
"  let command = join(map(split(a:command), 'expand(v:val)'))
"  let winnr = bufwinnr('^' . command . '$')
"  execute  winnr < 0 ? 'botright new ' . fnameescape(command) : winnr . 'wincmd w'
"  setlocal buftype=nowrite bufhidden=wipe nobuflisted noswapfile nowrap number
"  echo 'Execute ' . command . '...'
"  silent! execute '!'. command
"  silent! execute 'resize ' . line('$')
"  silent! redraw
"  execute 'au BufUnload <buffer> execute bufwinnr(' . bufnr('#') . ') . ''wincmd w'''
"  echo 'Shell command ' . command . ' executed.'
"endfunction
"command! -complete=shellcmd -nargs=+ Shell call s:ExecuteInShell(<q-args>)
"map <leader>r :Shell python %<CR>
map <leader>r :!python %<CR>

function! exploit#insert_bp(lnum, cmd)
    let line = getline(a:lnum)
    if strridx(line, a:cmd) != -1
        normal dd
    else
        let plnum = prevnonblank(a:lnum)
        call append(line('.')-1, repeat(' ', indent(plnum)).a:cmd)
        normal k
    endif
endfunction
let g:pwn_pause_cmd = 'pause()  # XXX: STOP here'
map <leader>p :call exploit#insert_bp(line('.'), g:pwn_pause_cmd)<CR>
