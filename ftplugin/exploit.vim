if exists('g:loaded_pwn_ftplugin')
    finish
endif
let g:loaded_pwn_ftplugin = 1

function! s:RunInInteractiveShell(command)
  let saved_shellcmdflag = &shellcmdflag
  set shellcmdflag+=il
  try
    execute '!'. a:command
  finally
    execute 'set shellcmdflag=' . saved_shellcmdflag
  endtry
endfunction

command! -nargs=1 RunInInteractiveShell call <sid>RunInInteractiveShell(<f-args>)
map <leader>r :RunInInteractiveShell python %<CR>

function! exploit#insert_bp(lnum, cmd)
    let line = getline(a:lnum)
    if strridx(line, a:cmd) != -1
        normal dd
    else
        let plnum = prevnonblank(a:lnum)
        call append(line('.')-1, repeat(' ', indent(plnum)).a:cmd)
        normal k
    endif
endfunction
let g:pwn_pause_cmd = 'pause()  # XXX: STOP here'
map <leader>p :call exploit#insert_bp(line('.'), g:pwn_pause_cmd)<CR>
